<% if !@project.repository.nil? %>
<table class="table table-hover">
  <thead>
    <tr>
      <th><%= l(:field_identifier) %></th>
      <th><%= l(:field_repository_is_default) %></th>
      <th><%= l(:label_scm) %></th>
      <th><%= l(:label_repository) %></th>
      <th><%= l(:label_repository_default_branch) %></th>
      <th><%= l(:label_repository_enabled_capabilities) %></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><%= @project.repository.identifier.present? ? @project.repository.identifier : '' %></td>
      <td><%= checked_image repository.is_default? %></td>
      <td>
        <% if @project.repository.is_a?(Repository::Git) %>
          <span class="icon icon-git-logo"></span><%= h @project.repository.scm_name %>
        <% else %>
          <%= h @project.repository.scm_name %>
        <% end %>
      </td>
      <td>
        <%=link_to h(@project.repository.url), {:controller => 'repositories', :action => 'show', :id => @project, :repository_id => @project.repository.identifier_param} %>
      </td>
      <td>
        <% if @project.repository.is_a?(Repository::Git) %>
          <span class="label label-info"><%= repository.extra[:default_branch] %></span>
        <% else %>
        -
        <% end %>
      </td>
      <td align="center">
        <% if @project.repository.is_a?(Repository::Git) %>
          <span title="<%= l(:label_deployment_credentials) %><%= !@project.repository.repository_deployment_credentials.active.any? ? " (#{l(:label_disabled)})" : '' %>" class="icon icon-git icon-deployment-credentials <%= !@project.repository.repository_deployment_credentials.active.any? ? 'icon-git-disabled' : '' %>"></span>
          <span title="<%= l(:label_post_receive_urls) %><%= !@project.repository.repository_post_receive_urls.active.any? ? " (#{l(:label_disabled)})" : '' %>" class="icon icon-git icon-post-receive-urls <%= !@project.repository.repository_post_receive_urls.active.any? ? 'icon-git-disabled' : '' %>"></span>
          <span title="<%= l(:label_repository_mirrors) %><%= !@project.repository.repository_mirrors.active.any? ? " (#{l(:label_disabled)})" : '' %>" class="icon icon-git icon-mirrors <%= !@project.repository.repository_mirrors.active.any? ? 'icon-git-disabled' : '' %>"></span>
          <span title="<%= l(:label_git_daemon) %><%= !(@project.repository.project.is_public && @project.repository.extra[:git_daemon] == 1) ? " (#{l(:label_disabled)})" : '' %>" class="icon icon-git icon-git-daemon <%= !(@project.repository.project.is_public && @project.repository.extra[:git_daemon] == 1) ? 'icon-git-disabled' : '' %>"></span>
          <span title="<%= l(:label_smart_http) %><%= @project.repository.extra[:git_http] == 0 ? " (#{l(:label_disabled)})" : '' %>" class="icon icon-git icon-git-smarthttp <%= @project.repository.extra[:git_http] == 0 ? 'icon-git-disabled' : '' %>"></span>
          <span title="<%= l(:label_git_notify) %><%= @project.repository.extra[:git_notify] == 0 ? " (#{l(:label_disabled)})" : '' %>" class="icon icon-git icon-git-notify <%= @project.repository.extra[:git_notify] == 0 ? 'icon-git-disabled' : '' %>"></span>
        <% end %>
      </td>
      <td class="buttons">
      <% if User.current.allowed_to?(:manage_repository, @project) %>

        <%= link_to(l(:label_user_plural), committers_repository_path(@project.repository),
                                           :class => 'icon icon-user') %>

        <%= link_to(l(:button_edit), edit_repository_path(@project.repository),
                                     :class => 'icon icon-edit') %>

        <%= delete_link repository_path(@project.repository) %>
      <% end %>
      </td>
    </tr>
  </tbody>
</table>
<% end %>


<%= remote_form_for :repository, @repository,
                   :url => { :controller => '/repositories', :action => 'edit', :id => @project },
                   :builder => TabularFormBuilder,
                   :lang => current_language do |f| %>

<%= error_messages_for 'repository' %>

<div class="box tabular">
<p><%= label_tag('repository_scm', l(:label_scm)) %><%= scm_select_tag(@repository) %></p>
<%= repository_field_tags(f, @repository) if @repository %>
</div>

<div class="contextual">
<% if @repository && !@repository.new_record? %>
<%= link_to(l(:label_user_plural), {:controller => '/repositories', :action => 'committers', :project_id => @project}, :class => 'icon icon-user1') %>
<%= link_to(l(:button_delete), project_repository_path(@project),
            :confirm => l(:text_are_you_sure),
            :method => :delete,
            :class => 'icon icon-delete') %>
<% end %>
</div>

<%= submit_tag((@repository.nil? || @repository.new_record?) ? l(:button_create) : l(:button_save), :disabled => @repository.nil?) %>
<% end %>

